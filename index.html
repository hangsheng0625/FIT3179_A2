<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Renewable Energy Visualizations</title>

  <!-- Import Vega & Vega-Lite (from CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.5.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.21.0"></script>
  
  <!-- External CSS -->
  <link rel="stylesheet" type="text/css" href="css/styles.css" media="all">
</head>
<body>

  <!-- Div containers for the two graphs -->
  <div id="choropleth_map"></div>
  <div id="stacked_area_chart"></div>

  <script type="text/javascript">
    // Choropleth map Vega-Lite specification
    var choroplethSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": "Global Renewable Energy Share (% of Equivalent Primary Energy) - 2023",
      "width": 800,
      "height": 500,
      "projection": {"type": "equalEarth"},
      "data": {
        "url": "https://raw.githubusercontent.com/hangsheng0625/FIT3179_A2/main/js/ne_110m_admin_0_countries.json",
        "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
      },
      "transform": [
        {
          "lookup": "properties.NAME",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/hangsheng0625/FIT3179_A2/main/data/renewable-share-energy-(map).csv"
            },
            "key": "Entity",
            "fields": ["Year", "Renewables (% equivalent primary energy)"]
          }
        },
        {
          "filter": "datum.Year == 2023"
        }
      ],
      "layer": [
        {
          "mark": {"type": "geoshape"},
          "encoding": {
            "color": {
              "field": "Renewables (% equivalent primary energy)",
              "type": "quantitative",
              "scale": {
                "scheme": "bluegreen",
                "domain": [0, 100]
              }
            },
            "tooltip": [
              {"field": "properties.NAME", "type": "nominal", "title": "Country"},
              {
                "field": "Renewables (% equivalent primary energy)",
                "type": "quantitative",
                "title": "Renewable Energy Share (%)",
                "format": ".2f"
              }
            ]
          }
        },
        {
          "mark": {
            "type": "text",
            "fontSize": 13,
            "fontWeight": "normal",
            "color": "darkgreen"
          },
          "encoding": {
            "x": {"value": 330},
            "y": {"value": 240},
            "text": {"value": "Norway has the"}
          }
        },
        {
          "mark": {
            "type": "text",
            "fontSize": 20,
            "fontWeight": "bold",
            "color": "darkgreen"
          },
          "encoding": {
            "x": {"value": 415},
            "y": {"value": 240},
            "text": {"value": "highest"}
          }
        },
        {
          "mark": {
            "type": "text",
            "fontSize": 13,
            "fontWeight": "normal",
            "color": "darkgreen"
          },
          "encoding": {
            "x": {"value": 485},
            "y": {"value": 240},
            "text": {"value": "renewable"}
          }
        },
        {
          "mark": {
            "type": "text",
            "fontSize": 13,
            "fontWeight": "normal",
            "color": "darkgreen"
          },
          "encoding": {
            "x": {"value": 405},
            "y": {"value": 260},
            "text": {"value": "energy share in 2023"}
          }
        }
      ]
    };

    // Stacked area chart Vega-Lite specification
    var stackedAreaSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": "Renewable Energy Generation by Source Over Time",
      "width": 800,
      "height": 400,
      "data": {
        "url": "https://raw.githubusercontent.com/hangsheng0625/FIT3179_A2/main/data/modern-renewable-energy-consumption.csv"
      },
      "transform": [
        {
          "fold": [
            "Other renewables (including geothermal and biomass) electricity generation - TWh",
            "Solar generation - TWh",
            "Wind generation - TWh",
            "Hydro generation - TWh"
          ],
          "as": ["Electricity_source", "Value"]
        }
      ],
      "mark": "area",
      "params": [{
        "name": "source_highlight",
        "select": {
          "type": "point",
          "fields": ["Electricity_source"]
        },
        "bind": "legend"
      }],
      "encoding": {
        "x": {
          "field": "Year",
          "type": "temporal",
          "axis": {
            "grid": false,
            "tickCount": 10
          }
        },
        "y": {
          "aggregate": "sum",
          "field": "Value",
          "title": "Total Electricity Generation (TWh)",
          "stack": true
        },
        "color": {
          "field": "Electricity_source",
          "type": "nominal",
          "scale": {
            "domain": [
              "Other renewables (including geothermal and biomass) electricity generation - TWh",
              "Solar generation - TWh",
              "Wind generation - TWh",
              "Hydro generation - TWh"
            ],
            "range": [
              "#a65628",
              "#4daf4a",
              "#377eb8",
              "#984ea3"
            ]
          },
          "legend": {
            "orient": "right",
            "labelFontSize": 12,
            "titleFontSize": 12
          }
        },
        "opacity": {
          "condition": {"param": "source_highlight", "value": 1},
          "value": 0.2
        },
        "tooltip": [
          {
            "field": "Electricity_source",
            "type": "nominal",
            "title": "Source of Electricity"
          },
          {
            "field": "Year",
            "type": "temporal",
            "format": "%Y",
            "title": "Year"
          },
          {
            "field": "Value",
            "type": "quantitative",
            "title": "Generation (TWh)",
            "format": ".2f"
          }
        ]
      }
    };

    // Embed the choropleth map
    vegaEmbed('#choropleth_map', choroplethSpec).then(function(result) {
      // Access the Vega view instance (https://vega.github.io/vega/docs/api/view/) as result.view
    }).catch(console.error);

    // Embed the stacked area chart
    vegaEmbed('#stacked_area_chart', stackedAreaSpec).then(function(result) {
      // Access the Vega view instance (https://vega.github.io/vega/docs/api/view/) as result.view
    }).catch(console.error);

  </script>

</body>
</html>
